
version: "3.9"
services:
  api:
    build:
      context: ./backend
      dockerfile: Dockerfile
    env_file: ./backend/.env.example
    volumes: [ "./backend:/app" ]
    ports: [ "8000:8000" ]
    depends_on: [ redis, mailhog ]
    command: bash -lc "pip install -r requirements.txt && python ml/train.py && uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload"
  redis:
    image: redis:7
  mailhog:
    image: mailhog/mailhog
    ports: [ "8025:8025" ]
  web:
    build:
      context: ./frontend-next
      dockerfile: Dockerfile
    environment:
      NEXT_PUBLIC_API_BASE: http://localhost:8000
    ports: [ "3000:3000" ]
    depends_on: [ api ]
